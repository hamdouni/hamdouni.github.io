<!doctype html><html lang=en><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Brahim Hamdouni's website"><title>Barim's blog · ابراهيم - Understanding Svelte Component Lifecycle and Reactivity</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax.css><body><nav><details class=wrapped><summary><div><svg class="icon open" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
<svg class="icon close" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg>
<span class=brand>Barim's blog · ابراهيم</span></div><span class=lang><a href=https://brahim.hamdouni.com/post/2025-03-01-svelte-component-lifecycle-reactivity/>fr</a></span></summary><div class=links><a href=/><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11 2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
Home
</a><a href=/post><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
Posts
</a><a href=/lists><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4A1 1 0 003 5v14a1 1 0 001 1z"/></svg>
Lists
</a><a href=/search><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg>
Search
</a><a href=/about><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
About</a></div></details></nav><div id=content class=wrapped><main><header><h1>Understanding Svelte Component Lifecycle and Reactivity</h1><em></em><div class=date>Saturday, March 1, 2025 · 3 minutes · 634 words</div></header><article><p>Svelte&rsquo;s component system features a specific approach to reactivity and component initialization. This article explores a common misconception about how props, variables, and component initialization work in Svelte.</p><h2 id=the-misconception>The Misconception</h2><p>Developers new to Svelte might assume that when a prop changes, the entire component script runs again, like if the component was a function and the prop a parameter: if the prop changes, the <code>function</code> will give another result, right?
This isn&rsquo;t how Svelte operates, and understanding this distinction is important for building functional applications.</p><h2 id=analyzing-the-example>Analyzing the Example</h2><p>The example demonstrates this concept with two components:</p><ol><li><strong>app.svelte</strong>: A parent component with buttons to select different names</li><li><strong>name.svelte</strong>: A child component that receives a name prop and tracks modifications</li></ol><h3 id=the-parent-component-appsvelte>The Parent Component (app.svelte)</h3><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-svelte data-lang=svelte><span class=line><span class=ln> 1</span><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>// This shows that changing the prop does not rerun the component
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>    <span class=c1>// script.
</span></span></span><span class=line><span class=ln> 4</span><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=ln> 5</span><span class=cl>    <span class=kr>import</span> <span class=nx>InputName</span> <span class=nx>from</span> <span class=s2>&#34;./name.svelte&#34;</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=kd>let</span> <span class=nx>names</span> <span class=o>=</span> <span class=p>[</span><span class=s2>&#34;John&#34;</span><span class=p>,</span> <span class=s2>&#34;Mila&#34;</span><span class=p>,</span> <span class=s2>&#34;Ali&#34;</span><span class=p>];</span>	
</span></span><span class=line><span class=ln> 7</span><span class=cl>    <span class=kd>let</span> <span class=nx>selected</span> <span class=o>=</span> <span class=nx>$state</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=c>&lt;!-- This selector trigger the prop change in child component --&gt;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl><span class=p>{</span><span class=k>#each</span> <span class=nx>names</span> <span class=kr>as</span> <span class=nx>name</span><span class=p>}</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>&lt;</span><span class=nt>button</span> <span class=na>onclick</span><span class=o>=</span><span class=p>{()</span> <span class=o>=&gt;</span> <span class=nx>selected</span><span class=o>=</span><span class=nx>name</span><span class=p>}</span><span class=err>&gt;</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=s>&lt;/button</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl><span class=p>{</span><span class=k>/each</span><span class=p>}</span>
</span></span><span class=line><span class=ln>14</span><span class=cl>
</span></span><span class=line><span class=ln>15</span><span class=cl><span class=c>&lt;!-- This section call the child component with the prop --&gt;</span>
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>{</span><span class=k>#if</span> <span class=nx>selected</span><span class=p>}</span>
</span></span><span class=line><span class=ln>17</span><span class=cl>    <span class=p>&lt;</span><span class=nt>InputName</span> <span class=na>name</span><span class=o>=</span><span class=p>{</span><span class=nx>selected</span><span class=p>}</span><span class=s>/</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>18</span><span class=cl><span class=p>{</span><span class=k>/if</span><span class=p>}</span>
</span></span></code></pre></div><p>The parent component:</p><ul><li>Maintains a list of names and a selected name state</li><li>Renders buttons for each name that update the <code>selected</code> variable</li><li>Also renders the <code>InputName</code> component with the selected name</li></ul><h3 id=the-child-component-namesvelte>The Child Component (name.svelte)</h3><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-svelte data-lang=svelte><span class=line><span class=ln> 1</span><span class=cl><span class=p>&lt;</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl>    <span class=c1>// This is a simple component that implements change detection
</span></span></span><span class=line><span class=ln> 3</span><span class=cl><span class=c1></span>	
</span></span><span class=line><span class=ln> 4</span><span class=cl>    <span class=kd>let</span> <span class=p>{</span> <span class=nx>name</span> <span class=p>}</span> <span class=o>=</span> <span class=nx>$props</span><span class=p>();</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl>	
</span></span><span class=line><span class=ln> 6</span><span class=cl>    <span class=c1>// this is executed only once at component mount
</span></span></span><span class=line><span class=ln> 7</span><span class=cl><span class=c1></span>    <span class=kd>let</span> <span class=nx>original</span> <span class=o>=</span> <span class=nx>name</span><span class=p>;</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>
</span></span><span class=line><span class=ln> 9</span><span class=cl>    <span class=kd>let</span> <span class=nx>changed</span> <span class=o>=</span> <span class=nx>$derived</span><span class=p>(</span><span class=nx>original</span> <span class=o>!=</span> <span class=nx>name</span><span class=p>);</span>
</span></span><span class=line><span class=ln>10</span><span class=cl><span class=p>&lt;/</span><span class=nt>script</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>
</span></span><span class=line><span class=ln>12</span><span class=cl>Name : <span class=p>&lt;</span><span class=nt>input</span> <span class=na>type</span><span class=o>=</span><span class=s>&#34;text&#34;</span> <span class=na>bind:value</span><span class=o>=</span><span class=p>{</span><span class=nx>name</span><span class=p>}</span><span class=err>&gt;</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=p>{</span><span class=k>#if</span> <span class=nx>changed</span><span class=p>}</span>
</span></span><span class=line><span class=ln>15</span><span class=cl>    modified
</span></span><span class=line><span class=ln>16</span><span class=cl><span class=p>{</span><span class=k>/if</span><span class=p>}</span>
</span></span></code></pre></div><p>The child component:</p><ul><li>Receives a <code>name</code> prop using <code>$props()</code></li><li>Stores the initial value in an <code>original</code> variable</li><li>Uses <code>$derived</code> to create a reactive <code>changed</code> variable that compares current and original values</li><li>Displays &ldquo;modified&rdquo; when the input value differs from the original</li></ul><h2 id=the-problem>The Problem</h2><p>When we click on a name and start updating the field, it shows the &lsquo;modified&rsquo; indicator. This appears to work correctly.</p><p>However, when we click on another name, the indicator remains visible. We can also trigger this issue by clicking on the first name without modifying it, then clicking a second name: the &lsquo;modified&rsquo; indicator appears despite not updating anything.</p><p>The key insight is that the component&rsquo;s script block runs only once when the component is initially mounted. When props change, Svelte updates the reactive dependencies without re-running the entire script.</p><p>This means that <code>let original = name;</code> is executed only once during component initialization. When the <code>name</code> prop changes later:</p><ol><li>The <code>name</code> value updates</li><li>The <code>changed</code> derived value recalculates</li><li>But the variable <code>original</code> still holds the first value it received</li></ol><h2 id=the-solution>The Solution</h2><p>To force the child component to re-execute its script when the <code>name</code> prop changes, we use a <code>{#key}</code> block in the parent component.</p><p>The <code>{#key var}</code> block triggers at <code>var</code> updates by destroying and recreating the components it surrounds.</p><p>For our example, we need to modify our code like this:</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-svelte data-lang=svelte><span class=line><span class=ln>1</span><span class=cl><span class=c>&lt;!-- This section call the child component with the prop --&gt;</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=p>{</span><span class=k>#if</span> <span class=nx>selected</span><span class=p>}</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=p>{</span><span class=k>#key</span> <span class=nx>selected</span><span class=p>}</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>        <span class=p>&lt;</span><span class=nt>InputName</span> <span class=na>name</span><span class=o>=</span><span class=p>{</span><span class=nx>selected</span><span class=p>}</span><span class=s>/</span><span class=p>&gt;</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=p>{</span><span class=k>/key</span><span class=p>}</span>
</span></span><span class=line><span class=ln>6</span><span class=cl><span class=p>{</span><span class=k>/if</span><span class=p>}</span>
</span></span></code></pre></div><p>When <code>selected</code> changes:</p><ul><li>Without <code>{#key}</code>, the same component instance would remain and the variable <code>original</code> would never update</li><li>With <code>{#key}</code>, Svelte destroys and recreates the <code>InputName</code> component, causing the script to run again and the variable <code>original</code> to be reset</li></ul><h2 id=conclusion>Conclusion</h2><ol><li><strong>Be aware of one-time initialization</strong>: Variables assigned directly in the script block are initialized only once.</li><li><strong>Use reactive declarations</strong>: Leverage <code>$derived</code> for values that need to react to prop changes.</li><li><strong>Understand when to use <code>{#key}</code></strong>: Use it when you need to completely reset a component state, like in our example for change detection patterns.</li></ol><span class=tags><a class=tag href=/tags/svelte/>Svelte</a></span><div class=links><span class=link><a href=https://barim.us/post/2024-12-14-tuto-svelte-dynamic-components/>← Tutorial: Dynamic Svelte Components</a>
</span><span class=link><a href=https://barim.us/post/2025-06-02-youtube/>YouTube thumbnails and uBlock Origin →</a></span></div></article></main></div></body></html>