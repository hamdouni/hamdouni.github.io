<!doctype html><html lang=en><meta charset=UTF-8><meta http-equiv=X-UA-Compatible content="IE=edge"><meta name=viewport content="width=device-width,initial-scale=1"><meta name=description content="Brahim Hamdouni's website"><title>Barim's blog · ابراهيم - Use LanguageTool with neovim</title>
<link rel=stylesheet href=/css/style.css><link rel=stylesheet href=/css/syntax.css><body><nav><details class=wrapped><summary><div><svg class="icon open" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M4 6h16M4 12h16M4 18h16"/></svg>
<svg class="icon close" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M6 18 18 6M6 6l12 12"/></svg>
<span class=brand>Barim's blog · ابراهيم</span></div></summary><div class=links><a href=/><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M3 12l2-2m0 0 7-7 7 7M5 10v10a1 1 0 001 1h3m10-11 2 2m-2-2v10a1 1 0 01-1 1h-3m-6 0a1 1 0 001-1v-4a1 1 0 011-1h2a1 1 0 011 1v4a1 1 0 001 1m-6 0h6"/></svg>
Home
</a><a href=/post><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 20H5a2 2 0 01-2-2V6a2 2 0 012-2h10a2 2 0 012 2v1m2 13a2 2 0 01-2-2V7m2 13a2 2 0 002-2V9a2 2 0 00-2-2h-2m-4-3H9M7 16h6M7 8h6v4H7V8z"/></svg>
Posts
</a><a href=/showcase><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 6.042A8.967 8.967.0 006 3.75c-1.052.0-2.062.18-3 .512v14.25A8.987 8.987.0 016 18c2.305.0 4.408.867 6 2.292m0-14.25a8.966 8.966.0 016-2.292c1.052.0 2.062.18 3 .512v14.25A8.987 8.987.0 0018 18a8.967 8.967.0 00-6 2.292m0-14.25v14.25"/></svg>
Showcase
</a><a href=/lists><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 4v16M17 4v16M3 8h4m10 0h4M3 12h18M3 16h4m10 0h4M4 20h16a1 1 0 001-1V5a1 1 0 00-1-1H4A1 1 0 003 5v14a1 1 0 001 1z"/></svg>
Lists
</a><a href=/search><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M21 21l-6-6m2-5A7 7 0 113 10a7 7 0 0114 0z"/></svg>
Search
</a><a href=/about><svg class="icon" fill="none" viewBox="0 0 24 24" stroke="currentcolor" stroke-width="2"><path stroke-linecap="round" stroke-linejoin="round" d="M16 7A4 4 0 118 7a4 4 0 018 0zm-4 7a7 7 0 00-7 7h14a7 7 0 00-7-7z"/></svg>
About</a></div></details></nav><div id=content class=wrapped><main><header><h1>Use LanguageTool with neovim</h1><em></em><div class=date>Sunday, December 24, 2023 · 3 minutes · 615 words</div></header><article><p>I do a lot of mistakes when typing. The use of a spellchecker in neovim is easy but not enough : I mostly do grammar mistakes.</p><p>So how can we leverage neovim to not only check for spelling but also for grammar ? And if possible, how to do it for multiple languages as I also write in French ?</p><p>We can integrate LanguageTool <sup id=fnref:1><a href=#fn:1 class=footnote-ref role=doc-noteref>1</a></sup> with neovim using LTeX <sup id=fnref:2><a href=#fn:2 class=footnote-ref role=doc-noteref>2</a></sup>.</p><p><strong>This is my plan</strong></p><ul><li>Install LTeX in neovim using Mason</li><li>Apply LanguageTool suggestion using Code Actions</li><li>Use Telescope for the code actions suggestion</li><li>Tips : force the language in Markdown</li></ul><h2 id=install-ltex-in-neovim-using-mason>Install LTeX in neovim using Mason</h2><p>You can manually install LTeX in neovim with the following command</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-vim data-lang=vim><span class=line><span class=ln>1</span><span class=cl><span class=p>:</span><span class=nx>MasonInstall</span> <span class=nx>ltex</span><span class=p>-</span><span class=nx>ls</span>
</span></span></code></pre></div><p>But, if you want to make it permanent in your configuration, or you want to change its default options, you will need to add it to your neovim init.lua. I have a special section for neovim to install and configure all my language servers in neovim. I declare an array <code>servers</code> :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl><span class=kd>local</span> <span class=n>servers</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl><span class=p>...</span>
</span></span><span class=line><span class=ln>3</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><p>and inside, for each language, I have this sort of snippet :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl>  <span class=n>ltex</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=n>ltex</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>      <span class=n>language</span> <span class=o>=</span> <span class=s2>&#34;fr&#34;</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>  <span class=p>},</span>
</span></span></code></pre></div><p>This one is for LTeX, setting the default language to French.
The first key is the language server name and the second is its settings object.
It is not always the same as for <code>ltex</code>. See, for example, the Lua version :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl>  <span class=n>lua_ls</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=n>Lua</span> <span class=o>=</span> <span class=p>{</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>      <span class=n>workspace</span> <span class=o>=</span> <span class=p>{</span> <span class=n>checkThirdParty</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>      <span class=n>telemetry</span> <span class=o>=</span> <span class=p>{</span> <span class=n>enable</span> <span class=o>=</span> <span class=kc>false</span> <span class=p>},</span>
</span></span><span class=line><span class=ln>5</span><span class=cl>    <span class=p>},</span>
</span></span><span class=line><span class=ln>6</span><span class=cl>  <span class=p>},</span>
</span></span></code></pre></div><p>Here we have <code>lua_ls</code> for the language server name and <code>Lua</code> for the object setting.</p><p>Then, I have this code to configure all servers via mason :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln> 1</span><span class=cl><span class=c1>-- Ensure the servers are installed</span>
</span></span><span class=line><span class=ln> 2</span><span class=cl><span class=kd>local</span> <span class=n>mason_lspconfig</span> <span class=o>=</span> <span class=n>require</span> <span class=s1>&#39;mason-lspconfig&#39;</span>
</span></span><span class=line><span class=ln> 3</span><span class=cl><span class=n>mason_lspconfig.setup</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 4</span><span class=cl>  <span class=n>ensure_installed</span> <span class=o>=</span> <span class=n>vim.tbl_keys</span><span class=p>(</span><span class=n>servers</span><span class=p>),</span> <span class=c1>-- take every key entry to install the corresponding language server</span>
</span></span><span class=line><span class=ln> 5</span><span class=cl><span class=p>}</span>
</span></span><span class=line><span class=ln> 6</span><span class=cl><span class=n>mason_lspconfig.setup_handlers</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 7</span><span class=cl>  <span class=kr>function</span><span class=p>(</span><span class=n>server_name</span><span class=p>)</span>
</span></span><span class=line><span class=ln> 8</span><span class=cl>    <span class=n>require</span><span class=p>(</span><span class=s1>&#39;lspconfig&#39;</span><span class=p>)[</span><span class=n>server_name</span><span class=p>].</span><span class=n>setup</span> <span class=p>{</span>
</span></span><span class=line><span class=ln> 9</span><span class=cl>      <span class=n>capabilities</span> <span class=o>=</span> <span class=n>capabilities</span><span class=p>,</span>
</span></span><span class=line><span class=ln>10</span><span class=cl>      <span class=n>on_attach</span> <span class=o>=</span> <span class=n>on_attach</span><span class=p>,</span>
</span></span><span class=line><span class=ln>11</span><span class=cl>      <span class=n>settings</span> <span class=o>=</span> <span class=n>servers</span><span class=p>[</span><span class=n>server_name</span><span class=p>],</span> <span class=c1>-- associate each language server setting</span>
</span></span><span class=line><span class=ln>12</span><span class=cl>    <span class=p>}</span>
</span></span><span class=line><span class=ln>13</span><span class=cl>  <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=ln>14</span><span class=cl><span class=p>}</span>
</span></span></code></pre></div><h2 id=apply-languagetool-suggestions>Apply LanguageTool suggestions</h2><p>So now that we have LTeX configured, how can we use it ?</p><p>As LTeX works with LSP, like any other language server, we can use the Code Actions to apply suggestions.</p><p>For example, we can use this command :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl><span class=p>:</span><span class=n>lua</span> <span class=n>vim.lsp</span><span class=p>.</span><span class=n>buf.code_action</span><span class=p>()</span>
</span></span></code></pre></div><p>This brings the default neovim ui to select an action.</p><p>You better remap this to a key combination to make it more easily actionable :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl><span class=n>vim.keymap</span><span class=p>.</span><span class=n>set</span><span class=p>(</span><span class=s1>&#39;n&#39;</span><span class=p>,</span> <span class=s1>&#39;&lt;leader&gt;ca&#39;</span><span class=p>,</span> <span class=n>vim.lsp</span><span class=p>.</span><span class=n>buf.code_action</span><span class=p>,</span> <span class=p>{</span><span class=n>desc</span> <span class=o>=</span> <span class=s1>&#39;Code Action&#39;</span><span class=p>},</span> <span class=p>{</span><span class=n>noremap</span> <span class=o>=</span> <span class=kc>true</span><span class=p>,</span> <span class=n>silent</span> <span class=o>=</span> <span class=kc>true</span><span class=p>})</span>
</span></span></code></pre></div><h2 id=use-telescope-as-ui-selector>Use Telescope as UI selector</h2><p>The default code actions picker of neovim is minimalist : we have to type the number associated with the action we want to apply and then press enter.</p><p>There is a nice plugin to make Telescope the default ui selector. I added this lines to my init.lua :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-lua data-lang=lua><span class=line><span class=ln>1</span><span class=cl>  <span class=p>{</span>
</span></span><span class=line><span class=ln>2</span><span class=cl>    <span class=s1>&#39;nvim-telescope/telescope-ui-select.nvim&#39;</span><span class=p>,</span>
</span></span><span class=line><span class=ln>3</span><span class=cl>    <span class=n>config</span> <span class=o>=</span> <span class=kr>function</span><span class=p>()</span> <span class=n>require</span><span class=p>(</span><span class=s2>&#34;telescope&#34;</span><span class=p>).</span><span class=n>load_extension</span><span class=p>(</span><span class=s2>&#34;ui-select&#34;</span><span class=p>)</span> <span class=kr>end</span><span class=p>,</span>
</span></span><span class=line><span class=ln>4</span><span class=cl>  <span class=p>}</span>
</span></span></code></pre></div><p>Relaunch neovim and now, Telescope is used as a picker for the code actions.</p><h2 id=tips--force-the-language-in-markdown>Tips : force the language in Markdown</h2><p>By default, LTeX will use the default language we have configured above. But, what if you need to write a post in another language ?</p><p>An easy way is to provide LTeX with a special header in the front matter of your markdown :</p><div class="highlight full-width-content"><pre tabindex=0 class=chroma><code class=language-markdown data-lang=markdown><span class=line><span class=ln>1</span><span class=cl>---
</span></span><span class=line><span class=ln>2</span><span class=cl>title: A nice title
</span></span><span class=line><span class=ln>3</span><span class=cl>date: 2023-12-25T01:18:29+01:00
</span></span><span class=line><span class=ln>4</span><span class=cl>---
</span></span></code></pre></div><p>The <code>lang</code> entry contains the language code expected by LTeX as seen in <a href=https://valentjn.github.io/ltex/supported-languages.html>https://valentjn.github.io/ltex/supported-languages.html</a></p><div class=footnotes role=doc-endnotes><hr><ol><li id=fn:1><p><a href=https://languagetool.org/>LanguageTool</a> is a multilingual spelling, style and grammar checker&#160;<a href=#fnref:1 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li><li id=fn:2><p><a href=https://valentjn.github.io/ltex/>LTeX</a> plugs LanguageTool with editors via language server protocol (LSP)&#160;<a href=#fnref:2 class=footnote-backref role=doc-backlink>&#8617;&#xfe0e;</a></p></li></ol></div><div class=links><span class=link><a href=https://barim.us/post/2023-10-29-svelte-tabs/>← Create tabs in Svelte</a>
</span><span class=link><a href=https://barim.us/post/2024-02-20-kvm-screen-input/>Change screen input programatically on Linux →</a></span></div></article></main></div></body></html>